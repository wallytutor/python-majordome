
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Equilibrium in Fe-N system &#8212; Majordome  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'teaching/calphad_iron_nitrogen_';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Computing" href="../computing/index.html" />
    <link rel="prev" title="Teaching" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Majordome  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Majordome</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/index.html">Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/common_.html">Common utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/energy_.html">Energy models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/fluent_.html">Fluent files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/reactor_.html">Reactor models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/transport_.html">Transport properties</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced/index.html">Advanced</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/plug_.html">Plug flow coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/plug_phd_.html">Acetylene pyrolysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/pyvista_tips_.html">PyVista recipes</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules/index.html">API Docs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/common.html">majordome.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/energy.html">majordome.energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/fluent.html">majordome.fluent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/latex.html">majordome.latex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/plotting.html">majordome.plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/reactor.html">majordome.reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/transport.html">majordome.transport</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Teaching</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Equilibrium in Fe-N system</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../computing/index.html">Computing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../computing/introduction.html">Scientific computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/tools-git.html">Git version control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/tools-ssh.html">SSH key generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/tools-containers.html">Using containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/tools-selection.html">Selection of tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/tools-portable.html">Portable toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/system-windows.html">Working on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/system-linux.html">Working on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/ansys-fluent/tui.html">Text user interface (TUI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/elmer-csc/elmer.html">Elmer Multiphysics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/general-tips.html">General Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computing/services.html">Deploying services</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../programming/index.html">Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../programming/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/julia-tips.html">Julia tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/racket.html">Programming in Racket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/haskell.html">Minimal Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/other.html">Other languages</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developers/index.html">Development</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers/devel.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/onkwargs_.html">A note on <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> parsing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/teaching/calphad_iron_nitrogen_.py" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.py</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Equilibrium in Fe-N system</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Phases-modeling">Phases modeling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Problem-construction">Problem construction</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Equilibrium-in-Fe-N-system">
<h1>Equilibrium in Fe-N system<a class="headerlink" href="#Equilibrium-in-Fe-N-system" title="Link to this heading">#</a></h1>
<p>In this notebook we implement a sub-lattice model to compute Fe-N equilibrium in the temperature range applicable to continuous nitriding (900-950 K) in ferrite. The primary goal is to compute solubility of nitrogen in BCC-iron. We are also interested in the computation of nitrogen activity in both BCC and FCC iron. In some cases, due to the kinetics of phase transformation in practice, FCC phase can be suppressed and only activity of nitrogen (even above solubility limit) in BCC phase is of
practical interest.</p>
<p>In what follows the implementation is done as proposed by <em>Frisk, K. CALPHAD. Vol. 15, No. 1, p. 79-106, 1991</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">majordome</span><span class="w"> </span><span class="kn">import</span> <span class="n">Capturing</span><span class="p">,</span> <span class="n">standard_plot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">casadi</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">SX</span><span class="p">,</span>
    <span class="n">exp</span><span class="p">,</span>
    <span class="n">log</span> <span class="k">as</span> <span class="n">ln</span><span class="p">,</span>
    <span class="n">heaviside</span><span class="p">,</span>
    <span class="n">vertcat</span><span class="p">,</span>
    <span class="n">dot</span><span class="p">,</span>
    <span class="n">nlpsol</span><span class="p">,</span>
    <span class="n">Function</span><span class="p">,</span>
    <span class="n">linspace</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Phases-modeling">
<h2>Phases modeling<a class="headerlink" href="#Phases-modeling" title="Link to this heading">#</a></h2>
<p>Both BCC and FCC phases are modeled using a sub-lattice model where iron atoms occupy a first lattice and interstital sites are occupied by nitrogen or <em>vacancies</em>. A unit formula of <span class="math notranslate nohighlight">\((Fe)_{a}(N,Va)_{c}\)</span> is adopted to describe the compound, with <span class="math notranslate nohighlight">\(a=1\)</span> for both structures, and <span class="math notranslate nohighlight">\(c=1\)</span> for FCC and <span class="math notranslate nohighlight">\(c=3\)</span> for BCC iron. With these elements, the molar Gibbs energy of a phase is given by</p>
<div class="math notranslate nohighlight">
\[G_{m}=y_{N}{}^{\circ}G_{Fe:N}+y_{Va}{}^{\circ}G_{Fe:Va}+cRT(y_{N}\ln{y_{N}}+y_{Va}\ln{y_{Va}})+y_{N}y_{Va}{}^{\circ}L_{Fe:N,Va}+G_{m}^{mag}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_{j}\)</span> denotes the site fractions in interstitial sublattice and besides ideal mixing and entropy terms, a single excess term is added through coefficient <span class="math notranslate nohighlight">\(L_{Fe:N,Va}\)</span> and magnetic contribution <span class="math notranslate nohighlight">\(G_{m}^{mag}\)</span>. All <span class="math notranslate nohighlight">\({}^{\circ}G\)</span> and <span class="math notranslate nohighlight">\({}^{\circ}L\)</span> parameters are expressed in terms of temperature.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">g_sublaticce</span><span class="p">(</span><span class="n">x_nn</span><span class="p">,</span> <span class="n">g_fe_nn</span><span class="p">,</span> <span class="n">g_fe_va</span><span class="p">,</span> <span class="n">l_fe_nn_va</span><span class="p">,</span>
                 <span class="n">c</span><span class="p">,</span> <span class="n">Tc</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">afm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Sublattice model for BCC and FCC phases. &quot;&quot;&quot;</span>
    <span class="c1"># Compute site fraction of nitrogen in interstitial sub-lattice.</span>
    <span class="n">y_nn</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_nn</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x_nn</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="c1"># Compute site fraction of vacancies with balance.</span>
    <span class="n">y_va</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y_nn</span>

    <span class="c1"># Ideal mixing contribution.</span>
    <span class="n">gmix</span> <span class="o">=</span> <span class="n">y_nn</span> <span class="o">*</span> <span class="n">g_fe_nn</span> <span class="o">+</span> <span class="n">y_va</span> <span class="o">*</span> <span class="n">g_fe_va</span>

    <span class="c1"># Entropy terms contribution</span>
    <span class="n">smix</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_nn</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="n">y_nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_va</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="n">y_va</span><span class="p">))</span>

    <span class="c1"># Excess term contribution.</span>
    <span class="n">lmix</span> <span class="o">=</span> <span class="n">y_nn</span> <span class="o">*</span> <span class="n">y_va</span> <span class="o">*</span> <span class="n">l_fe_nn_va</span>

    <span class="c1"># Magnetic term contribution.</span>
    <span class="n">gmag</span> <span class="o">=</span> <span class="n">gm_magnetic</span><span class="p">(</span><span class="n">y_nn</span><span class="p">,</span> <span class="n">Tc</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">afm</span><span class="p">)</span>

    <span class="c1"># Compose molar Gibbs energy.</span>
    <span class="k">return</span> <span class="n">gmix</span> <span class="o">+</span> <span class="n">smix</span> <span class="o">+</span> <span class="n">lmix</span> <span class="o">+</span> <span class="n">gmag</span>
</pre></div>
</div>
</div>
<p>The magnetic contribution term is given by <span class="math notranslate nohighlight">\(G_{m}^{mag}\)</span></p>
<div class="math notranslate nohighlight">
\[G_{m}^{mag}=RT\ln{(1+\beta)f(\tau)}\qquad\text{where}\qquad\tau=\frac{T}{T_{C}}\]</div>
<p>where depending on Curie’s temperature <span class="math notranslate nohighlight">\(T_{C}\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}f(\tau)=\begin{cases}
\tau &lt; 1   \implies 1 - \dfrac{1}{A}\left[\dfrac{79\tau^{-1}}{140p}+\dfrac{474}{497}\left(\dfrac{1}{p} - 1\right)\left(\dfrac{\tau^3}{6}+\dfrac{\tau^9}{135}+\dfrac{\tau^{15}}{600}\right)\right]\\[20pt]
\tau \ge 1 \implies - \dfrac{1}{A}\left(\dfrac{\tau^{-5}}{10}+\dfrac{\tau^{-15}}{315}+\dfrac{\tau^{-25}}{1500}\right)
\end{cases}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[A=\dfrac{518}{1125}+\dfrac{11692}{15975}\left(\dfrac{1}{p} - 1\right)\]</div>
<p>Parameter <span class="math notranslate nohighlight">\(p\)</span> depends on structure and is 0.4 for BCC and 0.28 for FCC. If magnetization and Curie’s temperature are negative, they must be divided by <span class="math notranslate nohighlight">\(a=-3\)</span> for FCC (for BCC they are positive).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gm_magnetic</span><span class="p">(</span><span class="n">y_nn</span><span class="p">,</span> <span class="n">Tc</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">afm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Magnetic contribution to Gibbs energy of phase. &quot;&quot;&quot;</span>
    <span class="c1"># Transform negative values.</span>
    <span class="n">Tc</span> <span class="o">=</span> <span class="n">Tc</span> <span class="k">if</span> <span class="n">Tc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Tc</span> <span class="o">/</span> <span class="n">afm</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span> <span class="k">if</span> <span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">beta</span> <span class="o">/</span> <span class="n">afm</span>

    <span class="c1"># Composition dependency of magnetic term for FCC only.</span>
    <span class="k">if</span> <span class="n">afm</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">Tc</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_nn</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_nn</span><span class="p">)</span>

    <span class="c1"># Structure parameter.</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">518</span> <span class="o">/</span> <span class="mi">1125</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">11692</span> <span class="o">/</span> <span class="mi">15975</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">f_lo</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Function below Curie temperature. &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">79</span> <span class="o">/</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">474</span> <span class="o">/</span> <span class="mi">497</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">135</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">9</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">15</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">A</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">f_hi</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Function above Curie temperature. &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1500</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="n">A</span>

    <span class="c1"># Relative temperature.</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">Tc</span>

    <span class="c1"># Select temperature range with HEAVY-SIDE function.</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">heaviside</span><span class="p">(</span><span class="n">tau</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_lo</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">f_hi</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>

    <span class="c1"># Assembly model.</span>
    <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<p>Model coefficients are expressed in terms of temperature as polynomials as</p>
<div class="math notranslate nohighlight">
\[G = a_0 + a_1 T + a_2 T\log{T} + a_3 T^2 + a_4 T^3 + a_5 T^{-1}\]</div>
<p>Other terms might be added depending on phase and its reference state.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gparams</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Parameter representation with 6 coefficients. &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">T</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> <span class="n">T</span>
</pre></div>
</div>
</div>
</section>
<section id="Problem-construction">
<h2>Problem construction<a class="headerlink" href="#Problem-construction" title="Link to this heading">#</a></h2>
<p>To build the optimization problem we start by defining the required constants and symbols.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ELEMENT VA   VACUUM                    0.0000E+00  0.0000E+00  0.0000E+00 !</span>
<span class="c1"># ELEMENT FE   BCC_A2                    5.5847E+01  4.4890E+03  2.7280E+01 !</span>
<span class="c1"># ELEMENT N    1/2_MOLE_N2(G)            1.4007E+01  4.3350E+03  9.5751E+01 !</span>

<span class="c1"># Ideal gas constant [J/(mol.K)].</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">8.31446261815324</span>

<span class="c1"># Atomic masses.</span>
<span class="n">mm_fe</span> <span class="o">=</span> <span class="mf">5.5847E+01</span>
<span class="n">mm_nn</span> <span class="o">=</span> <span class="mf">1.4007E+01</span>

<span class="c1"># Symbol for system temperature.</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="c1"># Symbol for total molar fraction of nitrogen.</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">)</span>

<span class="c1"># Symbols for unknowns: phases fractions and compositions.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">x_nn</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x_nn&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Aliases for phases fractions.</span>
<span class="n">phi_alpha</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">phi_gamma</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Aliases for molar fraction in phases.</span>
<span class="n">x_nn_alpha</span> <span class="o">=</span> <span class="n">x_nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x_nn_gamma</span> <span class="o">=</span> <span class="n">x_nn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Next we provide <span class="math notranslate nohighlight">\(G-H_{SER}\)</span> for the pure elements, with reference state for iron being BCC and for nitrogen <span class="math notranslate nohighlight">\(\frac{1}{2}N_{2}(g)\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SER : BCC_A2 : CHECKED</span>
<span class="n">a_ghser_fe</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1224.83</span><span class="p">,</span> <span class="mf">124.134</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.5143</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.39752e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.89269e-08</span><span class="p">,</span> <span class="mf">77358.5</span><span class="p">)</span>
<span class="n">ghser_fe</span> <span class="o">=</span> <span class="n">gparams</span><span class="p">(</span><span class="n">a_ghser_fe</span><span class="p">)</span>

<span class="c1"># SER : 1/2 N2 : CHECKED</span>
<span class="n">a_ghser_nn</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3750.675</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.45425</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.7819</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.76686e-04</span><span class="p">,</span> <span class="mf">2.681e-09</span><span class="p">,</span> <span class="o">-</span><span class="mi">32374</span><span class="p">)</span>
<span class="n">ghser_nn</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">gparams</span><span class="p">(</span><span class="n">a_ghser_nn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The next cell provide all parameters for BCC description.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># G(BCC_A2,FE:VA;0) : CHECKED</span>
<span class="n">g_fe_va_alpha</span> <span class="o">=</span> <span class="n">ghser_fe</span>

<span class="c1"># G(BCC_A2,FE:N;0) : CHECKED</span>
<span class="n">a_g_fe_nn_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mi">93562</span><span class="p">,</span> <span class="mf">165.07</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">g_fe_nn_alpha</span> <span class="o">=</span> <span class="n">gparams</span><span class="p">(</span><span class="n">a_g_fe_nn_alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">ghser_fe</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">ghser_nn</span>

<span class="c1"># Magnetic model parameters : CHECKED.</span>
<span class="n">Tc_alpha</span><span class="p">,</span> <span class="n">beta_alpha</span><span class="p">,</span> <span class="n">p_alpha</span><span class="p">,</span> <span class="n">afm_alpha</span> <span class="o">=</span> <span class="mi">1043</span><span class="p">,</span> <span class="mf">2.22</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># BCC_A2 R-K parameter : CHECKED.</span>
<span class="n">l_fe_nn_va_alpha</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Stoichiometric parameter : CHECKED.</span>
<span class="n">c_alpha</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<p>The next cell provide all parameters for FCC description.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># G(FCC_A1,FE:VA;0) : CHECKED.</span>
<span class="n">a_g_fe_va_gamma</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1462.4</span><span class="p">,</span> <span class="mf">8.282</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.15</span><span class="p">,</span> <span class="mf">6.4e-04</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">g_fe_va_gamma</span> <span class="o">=</span> <span class="n">gparams</span><span class="p">(</span><span class="n">a_g_fe_va_gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">ghser_fe</span>

<span class="c1"># G(FCC_A1,FE:N;0) : CHECKED.</span>
<span class="n">a_g_fe_nn_gamma</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">37460</span><span class="p">,</span> <span class="mf">375.42</span><span class="p">,</span> <span class="o">-</span><span class="mf">37.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">g_fe_nn_gamma</span> <span class="o">=</span> <span class="n">gparams</span><span class="p">(</span><span class="n">a_g_fe_nn_gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">ghser_fe</span> <span class="o">+</span> <span class="n">ghser_nn</span>

<span class="c1"># Magnetic model parameters: CHECKED.</span>
<span class="n">Tc_gamma</span><span class="p">,</span> <span class="n">beta_gamma</span><span class="p">,</span> <span class="n">p_gamma</span><span class="p">,</span> <span class="n">afm_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="mi">201</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span>

<span class="c1"># FCC_A1 R-K parameter : CHECKED.</span>
<span class="n">l_fe_nn_va_gamma</span> <span class="o">=</span> <span class="o">-</span><span class="mf">26150.0</span>

<span class="c1"># Stoichiometric parameter : CHECKED.</span>
<span class="n">c_gamma</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<p>With all these parameters in hand we compute molar Gibbs energy of each phase.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BCC_A2 molar Gibbs energy.</span>
<span class="n">Gm_alpha</span> <span class="o">=</span> <span class="n">g_sublaticce</span><span class="p">(</span><span class="n">x_nn_alpha</span><span class="p">,</span> <span class="n">g_fe_nn_alpha</span><span class="p">,</span> <span class="n">g_fe_va_alpha</span><span class="p">,</span>
                        <span class="n">l_fe_nn_va_alpha</span><span class="p">,</span> <span class="n">c_alpha</span><span class="p">,</span> <span class="n">Tc_alpha</span><span class="p">,</span>
                        <span class="n">beta_alpha</span><span class="p">,</span> <span class="n">p_alpha</span><span class="p">,</span> <span class="n">afm_alpha</span><span class="p">)</span>

<span class="c1"># FCC_A1 molar Gibbs energy.</span>
<span class="n">Gm_gamma</span> <span class="o">=</span> <span class="n">g_sublaticce</span><span class="p">(</span><span class="n">x_nn_gamma</span><span class="p">,</span> <span class="n">g_fe_nn_gamma</span><span class="p">,</span> <span class="n">g_fe_va_gamma</span><span class="p">,</span>
                        <span class="n">l_fe_nn_va_gamma</span><span class="p">,</span> <span class="n">c_gamma</span><span class="p">,</span> <span class="n">Tc_gamma</span><span class="p">,</span>
                        <span class="n">beta_gamma</span><span class="p">,</span> <span class="n">p_gamma</span><span class="p">,</span> <span class="n">afm_gamma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Prepare equilibrium conditions with composition converted to mole fraction.</p>
<div class="math notranslate nohighlight">
\[x = \dfrac{w\bar{M}}{M_{N}}\qquad\text{where}\qquad{}\bar{M}=\left(\sum_{k}\dfrac{w_k}{M_k}\right)^{-1}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mass_to_mole_fraction</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert mass fraction of nitrogen into mole fraction.  &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">w</span> <span class="o">/</span> <span class="p">(</span><span class="n">mm_nn</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">mm_nn</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">mm_fe</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mole_to_mass_fraction</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert mole fraction of nitrogen into mass fraction.  &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">mm_nn</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">mm_nn</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">mm_fe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@standard_plot</span><span class="p">(</span><span class="n">resized</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_gibbs</span><span class="p">(</span><span class="n">_placeholder</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">T_num</span> <span class="o">=</span> <span class="mf">943.0</span>
    <span class="n">y_nn_rng</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">x_nn_rng</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">mass_to_mole_fraction</span><span class="p">(</span><span class="n">y_nn_rng</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">Gm_alpha_f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;Gm_alpha&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">x_nn_alpha</span><span class="p">],</span> <span class="p">[</span><span class="n">Gm_alpha</span><span class="p">])</span>
    <span class="n">Gm_gamma_f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;Gm_gamma&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">x_nn_gamma</span><span class="p">],</span> <span class="p">[</span><span class="n">Gm_gamma</span><span class="p">])</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_nn_rng</span><span class="p">,</span> <span class="n">Gm_alpha_f</span><span class="p">(</span><span class="n">T_num</span><span class="p">,</span> <span class="n">x_nn_rng</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_nn_rng</span><span class="p">,</span> <span class="n">Gm_gamma_f</span><span class="p">(</span><span class="n">T_num</span><span class="p">,</span> <span class="n">x_nn_rng</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Nitrogen mole fraction [-]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Gibbs energy [J/mol]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">plot_gibbs</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/teaching_calphad_iron_nitrogen__24_0.png" src="../_images/teaching_calphad_iron_nitrogen__24_0.png" />
</div>
</div>
<p>These elements allow to build the following optimization problem, where <span class="math notranslate nohighlight">\(f\)</span> is the cost function</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
f = \phi_{BCC}G_{m}^{BCC} + \phi_{FCC}G_{m}^{FCC} \\[12pt]
0 = \phi_{BCC}x_{N}^{BCC} + \phi_{FCC}x_{N}^{FCC} - x_{N}^{sys} \\[12pt]
0 = \phi_{BCC} + \phi_{FCC} - 1
\end{cases}\end{split}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assembly symbolicy cost function.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">phi_alpha</span> <span class="o">*</span> <span class="n">Gm_alpha</span> <span class="o">+</span> <span class="n">phi_gamma</span> <span class="o">*</span> <span class="n">Gm_gamma</span>

<span class="c1"># Create total nitrogen content constraint.</span>
<span class="n">g0</span> <span class="o">=</span> <span class="n">phi_alpha</span> <span class="o">*</span> <span class="n">x_nn_alpha</span> <span class="o">+</span> <span class="n">phi_gamma</span> <span class="o">*</span> <span class="n">x_nn_gamma</span> <span class="o">-</span> <span class="n">x0</span>

<span class="c1"># Constrain phase fractions.</span>
<span class="n">g1</span> <span class="o">=</span> <span class="n">phi_alpha</span> <span class="o">+</span> <span class="n">phi_gamma</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Create symbolic vectors.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">x_nn</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">g0</span><span class="p">,</span> <span class="n">g1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>

<span class="c1"># Construct optimization problem.</span>
<span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ipopt&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;print_level&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}</span>
<span class="n">nlpt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">}</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s1">&#39;solver&#39;</span><span class="p">,</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">,</span> <span class="n">nlpt</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The computation of nitrogen activity is done as proposed by <em>Kouba, R et al. CALPHAD, Vol. 71, 2020.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">nitrogen_activity</span><span class="p">(</span><span class="n">kn</span><span class="p">,</span> <span class="n">dg</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Nitrogen activity in material. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">kn</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dg</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p><strong>TODO: (place them here)</strong> Sample Thermo-Calc and OpenCalphad macros are provided in this directory to validate results of calculations. Consider changing temperature and composition for the different cases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ce</span><span class="p">(</span><span class="n">T0_num</span><span class="p">,</span> <span class="n">w0_num</span><span class="p">,</span> <span class="n">kn</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute equilibrium at given point. &quot;&quot;&quot;</span>
    <span class="n">x0_num</span> <span class="o">=</span> <span class="n">mass_to_mole_fraction</span><span class="p">(</span><span class="n">w0_num</span><span class="p">)</span>

    <span class="c1"># A good initial guess is expected for now.</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x0_num</span><span class="p">,</span> <span class="n">x0_num</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">Capturing</span><span class="p">()</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">guess</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">T0_num</span><span class="p">,</span> <span class="n">x0_num</span><span class="p">],</span>
                     <span class="n">lbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ubx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lbg</span><span class="o">=-</span><span class="n">tol</span><span class="p">,</span> <span class="n">ubg</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>

    <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;ac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nitrogen_activity</span><span class="p">(</span><span class="n">kn</span><span class="p">,</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="n">T0_num</span><span class="p">)</span>
    <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0_num</span>
    <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;w0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w0_num</span>

    <span class="k">return</span> <span class="n">sol</span><span class="p">,</span> <span class="n">output</span>
</pre></div>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Output for equilibrium:   1, DEFAULT_EQUILIBRIUM          2021.12.24
Conditions .................................................:
  1:T=943, 2:P=100000, 3:N=1, 4:W(N)=.0001
 Degrees of freedom are   0

Some global data, reference state SER ......................:
T=    943.00 K (   669.85 C), P=  1.0000E+05 Pa, V=  0.0000E+00 m3
N=   1.0000E+00 moles, B=   5.5830E+01 g, RT=   7.8406E+03 J/mol
G= -3.85639E+04 J, G/N=-3.8564E+04 J/mol, H= 2.1783E+04 J, S= 6.399E+01 J/K

Some data for components ...................................:
Component name    Moles      Mole-fr  Chem.pot/RT  Activities  Ref.state
FE                9.9960E-01  0.99960 -4.9162E+00  7.3269E-03  SER (default)
N                 3.9859E-04  0.00040  1.6698E+00  5.3109E+00  GAS

Some data for phases .......................................:
Name                Status Moles      Volume    Form.Units Cmp/FU dGm/RT  Comp:
BCC_A2.................. E  1.000E+00  0.00E+00  1.00E+00    1.00  0.00E+00  X:
 FE     9.99601E-01  N      3.98589E-04
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">ce</span><span class="p">(</span><span class="n">T0_num</span><span class="o">=</span><span class="mi">943</span><span class="p">,</span> <span class="n">w0_num</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
<span class="n">sol</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;f&#39;: DM(-38559.7),
 &#39;g&#39;: DM([1.0056e-08, 1.00598e-08]),
 &#39;lam_g&#39;: DM([34639.7, 37936.6]),
 &#39;lam_p&#39;: DM([63.9967, 34639.7]),
 &#39;lam_x&#39;: DM([609.335, -121.659, -0.00383474, -3.13667e-05]),
 &#39;x&#39;: DM([1, 2.56935e-09, 0.000398599, 0.0463803]),
 &#39;ac&#39;: DM(6.83639),
 &#39;x0&#39;: 0.0003985887274051929,
 &#39;w0&#39;: 0.0001}
</pre></div></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Output for equilibrium:   1, DEFAULT_EQUILIBRIUM          2021.12.24
Conditions .................................................:
  1:T=943, 2:P=100000, 3:N=1, 4:W(N)=.001
 Degrees of freedom are   0

Some global data, reference state SER ......................:
T=    943.00 K (   669.85 C), P=  1.0000E+05 Pa, V=  0.0000E+00 m3
N=   1.0000E+00 moles, B=   5.5681E+01 g, RT=   7.8406E+03 J/mol
G= -3.86822E+04 J, G/N=-3.8682E+04 J/mol, H= 2.1866E+04 J, S= 6.421E+01 J/K

Some data for components ...................................:
Component name    Moles      Mole-fr  Chem.pot/RT  Activities  Ref.state
FE                9.9602E-01  0.99602 -4.9192E+00  7.3050E-03  SER (default)
N                 3.9752E-03  0.00398  3.8087E+00  4.5090E+01  GAS

Some data for phases .......................................:
Name                Status Moles      Volume    Form.Units Cmp/FU dGm/RT  Comp:
BCC_A2.................. E  9.889E-01  0.00E+00  9.86E-01    1.00  0.00E+00  X:
 FE     9.96629E-01  N      3.37061E-03

FCC_A1.................. E  1.114E-02  0.00E+00  1.05E-02    1.06  0.00E+00  X:
 FE     9.42359E-01  N      5.76414E-02
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">ce</span><span class="p">(</span><span class="n">T0_num</span><span class="o">=</span><span class="mi">943</span><span class="p">,</span> <span class="n">w0_num</span><span class="o">=</span><span class="mf">0.0010</span><span class="p">)</span>
<span class="n">sol</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;f&#39;: DM(-38641.4),
 &#39;g&#39;: DM([1.00514e-08, 1.00721e-08]),
 &#39;lam_g&#39;: DM([19045.4, 38565.7]),
 &#39;lam_p&#39;: DM([64.2396, 19045.4]),
 &#39;lam_x&#39;: DM([6.11999e-05, -6.11999e-05, -0.000366476, -1.59498e-05]),
 &#39;x&#39;: DM([0.982689, 0.0173108, 0.00293426, 0.0630674]),
 &#39;ac&#39;: DM(6.908),
 &#39;x0&#39;: 0.003975203646706774,
 &#39;w0&#39;: 0.001}
</pre></div></div>
</div>
<p>Next we perform a stepping for confrontation with Thermo-Calc calculations over the full composition range.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w0_num</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ce</span><span class="p">(</span><span class="n">T0_num</span><span class="o">=</span><span class="mi">943</span><span class="p">,</span> <span class="n">w0_num</span><span class="o">=</span><span class="n">w</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w0_num</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_item</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Retrieve results for assembly of table. &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ac</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;X(N)&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">],</span>
        <span class="s1">&#39;W(N)&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;w0&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Total Gibbs energy&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
        <span class="s1">&#39;NP(BCC_A2)&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;NP(FCC_A1)&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;X(BCC_A2,N)&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;X(FCC_A1,N)&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s1">&#39;W(BCC_A2,N)&#39;</span><span class="p">:</span> <span class="n">mole_to_mass_fraction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="s1">&#39;W(FCC_A1,N)&#39;</span><span class="p">:</span> <span class="n">mole_to_mass_fraction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
        <span class="s1">&#39;ACR(N)&#39;</span><span class="p">:</span> <span class="n">ac</span>
    <span class="p">}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_item</span><span class="p">,</span> <span class="n">data</span><span class="p">)))</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>X(N)</th>
      <td>0.000000e+00</td>
      <td>3.332845e-04</td>
      <td>6.664026e-04</td>
      <td>9.993544e-04</td>
      <td>1.332140e-03</td>
    </tr>
    <tr>
      <th>W(N)</th>
      <td>0.000000e+00</td>
      <td>8.361204e-05</td>
      <td>1.672241e-04</td>
      <td>2.508361e-04</td>
      <td>3.344482e-04</td>
    </tr>
    <tr>
      <th>Total Gibbs energy</th>
      <td>-3.854278e+04</td>
      <td>-3.855740e+04</td>
      <td>-3.856840e+04</td>
      <td>-3.857803e+04</td>
      <td>-3.858677e+04</td>
    </tr>
    <tr>
      <th>NP(BCC_A2)</th>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>NP(FCC_A1)</th>
      <td>1.005618e-10</td>
      <td>2.433213e-09</td>
      <td>3.170560e-09</td>
      <td>1.304793e-09</td>
      <td>5.429872e-09</td>
    </tr>
    <tr>
      <th>X(BCC_A2,N)</th>
      <td>1.009993e-08</td>
      <td>3.332944e-04</td>
      <td>6.664125e-04</td>
      <td>9.993644e-04</td>
      <td>1.332150e-03</td>
    </tr>
    <tr>
      <th>X(FCC_A1,N)</th>
      <td>4.350222e-04</td>
      <td>4.558125e-02</td>
      <td>4.890578e-02</td>
      <td>5.374563e-02</td>
      <td>5.319149e-02</td>
    </tr>
    <tr>
      <th>W(BCC_A2,N)</th>
      <td>2.533167e-09</td>
      <td>8.361454e-05</td>
      <td>1.672266e-04</td>
      <td>2.508386e-04</td>
      <td>3.344506e-04</td>
    </tr>
    <tr>
      <th>W(FCC_A1,N)</th>
      <td>1.091436e-04</td>
      <td>1.183645e-02</td>
      <td>1.273259e-02</td>
      <td>1.404551e-02</td>
      <td>1.389468e-02</td>
    </tr>
    <tr>
      <th>ACR(N)</th>
      <td>6.821646e+00</td>
      <td>6.834379e+00</td>
      <td>6.843973e+00</td>
      <td>6.852387e+00</td>
      <td>6.860034e+00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@standard_plot</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">resized</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_step</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">bcc_stable</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;NP(BCC_A2)&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0e-06</span><span class="p">]</span>
    <span class="n">fcc_stable</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;NP(FCC_A1)&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0e-06</span><span class="p">]</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;W(N)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NP(BCC_A2)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;W(N)&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NP(FCC_A1)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total nitrogen mass fraction [-]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase amount [mol]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bcc_stable</span><span class="p">[</span><span class="s1">&#39;W(N)&#39;</span><span class="p">],</span> <span class="n">bcc_stable</span><span class="p">[</span><span class="s1">&#39;W(BCC_A2,N)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fcc_stable</span><span class="p">[</span><span class="s1">&#39;W(N)&#39;</span><span class="p">],</span> <span class="n">fcc_stable</span><span class="p">[</span><span class="s1">&#39;W(FCC_A1,N)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FCC&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total nitrogen mass fraction [-]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Nitrogen mass fraction in phase [-]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">plot_step</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/teaching_calphad_iron_nitrogen__38_0.png" src="../_images/teaching_calphad_iron_nitrogen__38_0.png" />
</div>
</div>
<p><strong>TODO: re-run OC and generate images!</strong></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Teaching</p>
      </div>
    </a>
    <a class="right-next"
       href="../computing/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Computing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Phases-modeling">Phases modeling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Problem-construction">Problem construction</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Walter Dal'Maz Silva
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Walter Dal&#39;Maz Silva.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>